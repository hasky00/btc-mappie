<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="description" content="A community-maintained Bitcoin map powered by Nostr. Discover and publish signed listings for merchants, meetups, ATMs, and services." />
  <meta name="theme-color" content="#0b0f14" />
  <title>Bitcoin Map on Nostr — Signed, portable listings</title>

  <!-- Open Graph -->
  <meta property="og:title" content="Bitcoin Map on Nostr" />
  <meta property="og:description" content="Find and organize Bitcoin-friendly places. Publish signed listings via Nostr relays." />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="hero-preview.png" />
  <meta property="og:url" content="https://btcmap.org" />

  <!-- Leaflet.js Map Library -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

  <style>
    :root{
      --bg:#0b0f14;
      --panel:#0f1621;
      --text:#e7eef8;
      --muted:#a9b6c7;
      --line:rgba(255,255,255,.10);
      --accent:#f7931a; /* bitcoin orange */
      --accent2:#7dd3fc; /* subtle nostr-ish highlight */
      --shadow: 0 18px 60px rgba(0,0,0,.45);
      --radius: 16px;
      --max: 1120px;
      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }

    *{ box-sizing:border-box; }
    html{ scroll-behavior:smooth; }
    body{
      margin:0;
      font-family:var(--font);
      background:
        radial-gradient(900px 500px at 15% 10%, rgba(247,147,26,.18), transparent 60%),
        radial-gradient(700px 420px at 85% 15%, rgba(125,211,252,.14), transparent 55%),
        radial-gradient(800px 520px at 50% 95%, rgba(247,147,26,.10), transparent 60%),
        var(--bg);
      color:var(--text);
      line-height:1.5;
    }

    a{ color:inherit; text-decoration:none; }
    .container{ max-width:var(--max); margin:0 auto; padding:0 20px; }

    /* Top bar */
    .topbar{
      position:sticky; top:0; z-index:10;
      backdrop-filter: blur(10px);
      background: rgba(11,15,20,.72);
      border-bottom:1px solid var(--line);
    }
    .topbar-inner{
      display:flex; align-items:center; justify-content:space-between;
      padding:14px 0;
      gap:14px;
    }
    .brand{
      display:flex; align-items:center; gap:10px;
      font-weight:700; letter-spacing:.2px;
    }
    .logo{
      width:34px; height:34px; border-radius:10px;
      background:
        radial-gradient(circle at 30% 30%, rgba(255,255,255,.25), transparent 50%),
        linear-gradient(135deg, rgba(247,147,26,1), rgba(247,147,26,.35));
      box-shadow: 0 10px 30px rgba(247,147,26,.18);
      border:1px solid rgba(255,255,255,.12);
    }
    .nav{
      display:flex; gap:14px; align-items:center;
      color:var(--muted);
      font-weight:600;
      font-size:14px;
    }
    .nav a{ padding:8px 10px; border-radius:10px; }
    .nav a:hover{ background: rgba(255,255,255,.06); color:var(--text); }

    /* Buttons */
    .btn-row{ display:flex; gap:12px; flex-wrap:wrap; }
    .btn{
      display:inline-flex; align-items:center; justify-content:center;
      padding:12px 14px;
      border-radius:12px;
      font-weight:800;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      color:var(--text);
      box-shadow: 0 10px 30px rgba(0,0,0,.20);
      transition: transform .08s ease, background .15s ease, border-color .15s ease;
      user-select:none;
    }
    .btn:hover{ background: rgba(255,255,255,.09); border-color: rgba(255,255,255,.18); }
    .btn:active{ transform: translateY(1px); }
    .btn.primary{
      background: linear-gradient(135deg, rgba(247,147,26,1), rgba(247,147,26,.55));
      border-color: rgba(247,147,26,.55);
      color:#141414;
    }
    .btn.primary:hover{ border-color: rgba(247,147,26,.75); }
    .btn.ghost{
      background: transparent;
    }

    /* Hero */
    .hero{ padding:64px 0 26px; }
    .hero-grid{
      display:grid;
      grid-template-columns: 1.05fr .95fr;
      gap:28px;
      align-items:stretch;
    }
    .kicker{
      display:inline-flex; align-items:center; gap:10px;
      padding:8px 12px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
      border-radius:999px;
      color:var(--muted);
      font-weight:700;
      font-size:13px;
      width:fit-content;
    }
    .dot{
      width:10px; height:10px; border-radius:999px;
      background: var(--accent2);
      box-shadow: 0 0 0 6px rgba(125,211,252,.10);
    }
    h1{
      margin:14px 0 10px;
      font-size:46px;
      line-height:1.06;
      letter-spacing:-.6px;
    }
    .lead{
      margin:0 0 18px;
      color:var(--muted);
      font-size:16.5px;
      max-width: 58ch;
    }
    .micro{
      margin-top:12px;
      color:var(--muted);
      font-size:13px;
    }

    .hero-card{
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border: 1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding:18px;
      display:flex;
      flex-direction:column;
      gap:14px;
      min-height: 320px;
    }
    .mock{
      border-radius: 14px;
      border:1px dashed rgba(255,255,255,.20);
      background:
        radial-gradient(400px 220px at 40% 30%, rgba(247,147,26,.14), transparent 60%),
        radial-gradient(350px 200px at 70% 65%, rgba(125,211,252,.12), transparent 55%),
        rgba(0,0,0,.20);
      height: 210px;
      display:flex;
      align-items:center;
      justify-content:center;
      color: rgba(231,238,248,.75);
      font-weight:800;
      letter-spacing:.2px;
      text-align:center;
      padding:16px;
    }
    .hero-stats{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }
    .stat{
      padding:12px;
      border-radius: 14px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.04);
    }
    .stat .label{ color:var(--muted); font-size:12.5px; font-weight:700; }
    .stat .value{ font-size:16px; font-weight:900; margin-top:4px; }

    /* Sections */
    section{ padding: 26px 0; }
    .section-head{
      display:flex; align-items:flex-end; justify-content:space-between;
      gap:18px;
      margin-bottom: 14px;
    }
    h2{
      margin:0;
      font-size:26px;
      letter-spacing:-.2px;
    }
    .sub{
      margin:0;
      color:var(--muted);
      max-width: 70ch;
      font-size:15px;
    }

    .cards{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:14px;
    }
    .card{
      border: 1px solid var(--line);
      background: rgba(255,255,255,.04);
      border-radius: var(--radius);
      padding:16px;
    }
    .card h3{
      margin:0 0 8px;
      font-size:16px;
      letter-spacing:-.1px;
    }
    .card p{ margin:0; color:var(--muted); font-size:14px; }

    .steps{
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap:14px;
    }
    .step{
      border:1px solid var(--line);
      background: rgba(255,255,255,.04);
      border-radius: var(--radius);
      padding:16px;
    }
    .badge{
      width:34px; height:34px;
      border-radius: 12px;
      display:flex; align-items:center; justify-content:center;
      font-weight:900;
      background: rgba(247,147,26,.18);
      border: 1px solid rgba(247,147,26,.28);
      color: var(--text);
      margin-bottom: 10px;
    }
    .step h3{ margin:0 0 6px; font-size:15px; }
    .step p{ margin:0; color:var(--muted); font-size:14px; }

    /* FAQ */
    .faq{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:14px;
    }
    details{
      border:1px solid var(--line);
      background: rgba(255,255,255,.04);
      border-radius: var(--radius);
      padding:14px 14px;
    }
    summary{
      cursor:pointer;
      font-weight:800;
      list-style:none;
      outline:none;
    }
    summary::-webkit-details-marker{ display:none; }
    details p{ margin:10px 0 0; color:var(--muted); font-size:14px; }

    /* Footer CTA */
    .cta{
      border:1px solid rgba(247,147,26,.22);
      background: radial-gradient(700px 260px at 30% 30%, rgba(247,147,26,.18), transparent 60%),
                  rgba(255,255,255,.04);
      border-radius: var(--radius);
      padding: 18px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:16px;
      box-shadow: var(--shadow);
    }
    .cta h3{ margin:0 0 6px; font-size:18px; }
    .cta p{ margin:0; color:var(--muted); font-size:14px; }

    footer{
      padding: 26px 0 40px;
      color: var(--muted);
      font-size: 13px;
      border-top: 1px solid var(--line);
      margin-top: 26px;
    }
    .footer-row{
      display:flex; align-items:center; justify-content:space-between;
      gap:12px; flex-wrap:wrap;
    }
    .footer-links{ display:flex; gap:12px; flex-wrap:wrap; }
    .footer-links a{ color: var(--muted); }
    .footer-links a:hover{ color: var(--text); }

    /* Live Map */
    .map-wrap{
      position:relative;
      border-radius:14px;
      overflow:hidden;
      height:320px;
      border:1px solid var(--line);
    }
    #hero-map{
      height:100%;
      width:100%;
      background:#0a0e13;
      z-index:1;
    }
    .map-wrap .leaflet-control-zoom a{
      background:rgba(15,22,33,.88);
      color:var(--text);
      border-color:var(--line);
    }
    .map-wrap .leaflet-control-attribution{
      background:rgba(11,15,20,.7);
      color:var(--muted);
      font-size:10px;
    }
    .map-wrap .leaflet-control-attribution a{ color:var(--accent2); }
    .map-overlay{
      position:absolute;
      top:12px; left:12px;
      z-index:600;
      display:flex; flex-direction:column; gap:8px;
    }
    .map-chip{
      display:inline-flex; align-items:center; gap:6px;
      padding:7px 12px;
      border-radius:10px;
      background:rgba(15,22,33,.88);
      border:1px solid var(--line);
      backdrop-filter:blur(8px);
      font-size:12.5px;
      font-weight:700;
      color:var(--text);
      width:fit-content;
    }
    .map-chip .count{ color:var(--accent); }
    .locate-btn{
      position:absolute;
      bottom:12px; right:12px;
      z-index:600;
      width:38px; height:38px;
      border-radius:10px;
      border:1px solid var(--line);
      background:rgba(15,22,33,.88);
      backdrop-filter:blur(8px);
      color:var(--text);
      cursor:pointer;
      display:flex; align-items:center; justify-content:center;
      transition: background .15s, border-color .15s;
    }
    .locate-btn:hover{
      background:rgba(247,147,26,.2);
      border-color:rgba(247,147,26,.4);
    }
    .locate-btn svg{ width:18px; height:18px; }
    @keyframes pulse-ring{
      0%{ transform:scale(.6); opacity:.9; }
      100%{ transform:scale(2.2); opacity:0; }
    }
    .btc-marker{
      width:22px; height:22px;
      background:var(--accent);
      border:2.5px solid #fff;
      border-radius:50%;
      box-shadow:0 2px 8px rgba(247,147,26,.45);
      position:relative;
    }
    .btc-marker::after{
      content:'';
      position:absolute;
      top:-4px; left:-4px;
      width:26px; height:26px;
      border-radius:50%;
      background:rgba(247,147,26,.35);
      animation: pulse-ring 2s ease-out infinite;
    }
    .btc-popup .leaflet-popup-content-wrapper{
      background:rgba(15,22,33,.95);
      color:var(--text);
      border:1px solid var(--line);
      border-radius:12px;
      box-shadow:0 12px 40px rgba(0,0,0,.5);
    }
    .btc-popup .leaflet-popup-tip{ background:rgba(15,22,33,.95); }
    .btc-popup .leaflet-popup-content{ margin:12px 14px; font-family:var(--font); }
    .popup-name{
      font-weight:800; font-size:14px; margin-bottom:4px;
    }
    .popup-tags{
      display:flex; gap:5px; flex-wrap:wrap; margin-top:6px;
    }
    .popup-tag{
      padding:3px 8px;
      border-radius:6px;
      font-size:11px;
      font-weight:700;
      background:rgba(247,147,26,.15);
      border:1px solid rgba(247,147,26,.25);
      color:var(--accent);
    }
    .popup-tag.ln{ background:rgba(125,211,252,.12); border-color:rgba(125,211,252,.22); color:var(--accent2); }
    .popup-meta{
      margin-top:6px;
      font-size:11.5px;
      color:var(--muted);
    }
    .map-loading{
      position:absolute;
      inset:0;
      z-index:500;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      background:rgba(10,14,19,.85);
      gap:10px;
      transition: opacity .4s;
      pointer-events:none;
    }
    .map-loading.hidden{ opacity:0; }
    .map-spinner{
      width:32px; height:32px;
      border:3px solid rgba(247,147,26,.2);
      border-top-color:var(--accent);
      border-radius:50%;
      animation: spin .8s linear infinite;
    }
    @keyframes spin{ to{ transform:rotate(360deg); } }
    .map-loading span{ font-size:12.5px; font-weight:700; color:var(--muted); }

    /* Tag-place popup */
    .tag-popup .leaflet-popup-content-wrapper{
      background:rgba(15,22,33,.95);
      color:var(--text);
      border:1px solid rgba(247,147,26,.35);
      border-radius:12px;
      box-shadow:0 12px 40px rgba(0,0,0,.5);
    }
    .tag-popup .leaflet-popup-tip{ background:rgba(15,22,33,.95); }
    .tag-popup .leaflet-popup-content{ margin:12px 14px; font-family:var(--font); }
    .tag-title{
      font-weight:800; font-size:14px; margin-bottom:6px;
      display:flex; align-items:center; gap:6px;
    }
    .tag-title svg{ flex-shrink:0; }
    .tag-coords{
      font-size:11px; color:var(--muted); margin-bottom:10px;
      font-family:monospace;
    }
    .tag-btn{
      display:flex; align-items:center; justify-content:center; gap:6px;
      width:100%;
      padding:9px 14px;
      border-radius:10px;
      font-weight:800;
      font-size:13px;
      border:none;
      cursor:pointer;
      background:linear-gradient(135deg, rgba(247,147,26,1), rgba(247,147,26,.6));
      color:#141414;
      transition: opacity .15s;
      text-decoration:none;
    }
    .tag-btn:hover{ opacity:.88; }
    .tag-btn + .tag-btn{
      margin-top:6px;
      background:rgba(125,211,252,.15);
      border:1px solid rgba(125,211,252,.25);
      color:var(--accent2);
    }
    .tag-btn + .tag-btn:hover{ background:rgba(125,211,252,.22); }
    .tag-hint{
      margin-top:8px;
      font-size:10.5px;
      color:var(--muted);
      line-height:1.4;
    }

    /* Responsive */
    @media (max-width: 980px){
      .hero-grid{ grid-template-columns: 1fr; }
      .cards{ grid-template-columns: 1fr; }
      .steps{ grid-template-columns: 1fr 1fr; }
      .faq{ grid-template-columns: 1fr; }
      h1{ font-size: 38px; }
      .map-wrap{ height:280px; }
    }
    @media (max-width: 520px){
      .steps{ grid-template-columns: 1fr; }
      h1{ font-size: 34px; }
      .nav{ display:none; }
      .map-wrap{ height:240px; }
    }
  </style>
</head>

<body>
  <div class="topbar">
    <div class="container">
      <div class="topbar-inner">
        <div class="brand">
          <div class="logo" aria-hidden="true"></div>
          <div>
            Bitcoin Map on Nostr
            <div style="font-size:12px;color:var(--muted);font-weight:700;margin-top:1px;">
              Signed listings • Portable data
            </div>
          </div>
        </div>

        <nav class="nav">
          <a href="#why">Why</a>
          <a href="#how">How it works</a>
          <a href="#features">Features</a>
          <a href="#faq">FAQ</a>
        </nav>

        <div class="btn-row">
            <a class="btn ghost" href="https://github.com/btcmaporg/btc-mappie" target="_blank" rel="noreferrer">GitHub</a>
            <a class="btn primary" href="https://btcmap.org">Open the Map</a>
          <a class="btn ghost" href="YOUR_GITHUB_URL" target="_blank" rel="noreferrer">GitHub</a>
          <a class="btn primary" href="https://btcmap.org/map">Open the Map</a>
        </div>
      </div>
    </div>
  </div>

  <header class="hero">
    <div class="container">
      <div class="hero-grid">
        <div>
          <div class="kicker"><span class="dot" aria-hidden="true"></span> Nostr-native Bitcoin directory</div>
          <h1>Bitcoin-friendly places, organized by the community — powered by Nostr.</h1>
          <p class="lead">
            Discover merchants, meetups, ATMs, and services. Add listings that are
            <strong>cryptographically signed</strong>, portable across relays, and not locked into a single platform.
          </p>

          <div class="btn-row">
            <a class="btn primary" href="https://btcmap.org">Open the Map</a>
            <a class="btn" href="https://btcmap.org/add">Add a Place</a>
            <a class="btn ghost" href="https://njump.me/npub1us70e7q3jfxgvr4hghp8kaxjp0hg6aa2ux0qvd2s4m4y6d3wz46srr9g0u" target="_blank" rel="noreferrer">Follow on Nostr</a>
            <a class="btn primary" href="https://btcmap.org/map">Open the Map</a>
            <a class="btn" href="YOUR_ADD_PLACE_URL">Add a Place</a>
            <a class="btn ghost" href="YOUR_NOSTR_PROFILE_URL" target="_blank" rel="noreferrer">Follow on Nostr</a>
          </div>

          <p class="micro">
            No email. No account. Use your Nostr signer (NIP-07 / external signer).
            <strong>Never paste private keys</strong>.
          </p>
        </div>

        <div class="hero-card">
          <div class="map-wrap">
            <div id="hero-map"></div>
            <div class="map-overlay">
              <div class="map-chip">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>
                Live data from <span style="color:var(--accent);">BTCMap.org</span>
              </div>
              <div class="map-chip">
                <span class="count" id="merchant-count">0</span> places near you
              </div>
            </div>
            <button class="locate-btn" id="locate-btn" title="Find my location">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M12 2v3m0 14v3M2 12h3m14 0h3"/><circle cx="12" cy="12" r="8"/></svg>
            </button>
            <div class="map-loading" id="map-loading">
              <div class="map-spinner"></div>
              <span>Finding Bitcoin places nearby...</span>
            </div>
          </div>

          <div class="hero-stats">
            <div class="stat">
              <div class="label">Nearby places</div>
              <div class="value" style="color:var(--accent);" id="stat-places">Loading...</div>
            </div>
            <div class="stat">
              <div class="label">Data source</div>
              <div class="value">BTCMap + Nostr</div>
            </div>
            <div class="stat">
              <div class="label">Listings</div>
              <div class="value">Signed events</div>
            </div>
            <div class="stat">
              <div class="label">Lock-in</div>
              <div class="value" style="color:var(--accent2);">None</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>

  <main>
    <section id="why">
      <div class="container">
        <div class="section-head">
          <h2>Why this exists</h2>
          <p class="sub">Centralized maps become stale, fragile, and restrictive. A Bitcoin economy needs open, portable location data.</p>
        </div>

        <div class="cards">
          <div class="card">
            <h3>Maps go stale</h3>
            <p>Hours, payment support, and “still accepts Lightning” changes constantly. Community updates keep it current.</p>
          </div>
          <div class="card">
            <h3>Platforms disappear</h3>
            <p>If one app shuts down, you lose everything. Nostr makes contributions portable across relays and clients.</p>
          </div>
          <div class="card">
            <h3>Data gets locked</h3>
            <p>When listings live in one private database, builders can’t reuse them. Signed events are composable by design.</p>
          </div>
        </div>
      </div>
    </section>

    <section id="how">
      <div class="container">
        <div class="section-head">
          <h2>How it works</h2>
          <p class="sub">Publish places as signed data. Organize them into shareable lists. Discover using map + filters.</p>
        </div>

        <div class="steps">
          <div class="step">
            <div class="badge">1</div>
            <h3>Connect</h3>
            <p>Use a Nostr signer (NIP-07 or external signer) to authenticate without email or passwords.</p>
          </div>
          <div class="step">
            <div class="badge">2</div>
            <h3>Add or organize</h3>
            <p>Create a place listing, add tags (Lightning, on-chain, hours), or curate lists by city/topic.</p>
          </div>
          <div class="step">
            <div class="badge">3</div>
            <h3>Publish</h3>
            <p>Your client signs the event and publishes it to relays—portable, verifiable, and censorship-resistant.</p>
          </div>
          <div class="step">
            <div class="badge">4</div>
            <h3>Discover & share</h3>
            <p>Search on the map, open place cards, and share listings/lists over Nostr to grow adoption.</p>
          </div>
        </div>
      </div>
    </section>

    <section id="features">
      <div class="container">
        <div class="section-head">
          <h2>Built for Bitcoin communities</h2>
          <p class="sub">A practical directory for real-world spending and meetups, backed by signatures and community curation.</p>
        </div>

        <div class="cards">
          <div class="card">
            <h3>Nostr-native identity</h3>
            <p>Listings are signed by contributors. Reputation and history can be portable across Nostr clients.</p>
          </div>
          <div class="card">
            <h3>Filters that matter</h3>
            <p>Lightning / on-chain, “BTC only”, contactless, accessibility, hours, language, and more.</p>
          </div>
          <div class="card">
            <h3>Curated lists</h3>
            <p>Create collections like “Best coffee in town” or “Meetups this month” and share them as signed data.</p>
          </div>
          <div class="card">
            <h3>Verification signals</h3>
            <p>Show last-updated timestamps, confirmations, and community notes to reduce stale/false listings.</p>
          </div>
          <div class="card">
            <h3>Open by default</h3>
            <p>Export and reuse listings. Encourage an ecosystem of clients instead of one gatekeeper.</p>
          </div>
          <div class="card">
            <h3>Privacy-respecting</h3>
            <p>Minimal tracking. Location features are opt-in. You control what you publish and when.</p>
          </div>
        </div>
      </div>
    </section>

    <section id="faq">
      <div class="container">
        <div class="section-head">
          <h2>FAQ</h2>
          <p class="sub">Clear answers for new users, merchants, and contributors.</p>
        </div>

        <div class="faq">
          <details>
            <summary>Do I need an account?</summary>
            <p>No. You connect with a Nostr signer. Your keypair is your identity. Don’t paste private keys into websites—use a signer.</p>
          </details>

          <details>
            <summary>How is data verified?</summary>
            <p>Every listing is signed. The app can display provenance (who published), recency, and community confirmations/notes.</p>
          </details>

          <details>
            <summary>Which relays do you use?</summary>
            <p>Use a relay set that balances reliability and openness. Advanced users can customize their relay list in settings.</p>
          </details>

          <details>
            <summary>Can merchants claim their listing?</summary>
            <p>Yes. Merchants can publish updates from their own Nostr identity, and the app can display “owner published” signals.</p>
          </details>

          <details>
            <summary>Is my location tracked?</summary>
            <p>The landing page should be honest: avoid collecting precise location data unless necessary. If you use geolocation, make it opt-in and explain it clearly.</p>
          </details>

          <details>
            <summary>Is this open source?</summary>
            <p>If it is, link GitHub. If not yet, say “source-available soon” and publish a roadmap.</p>
          </details>
        </div>
      </div>
    </section>

    <section>
      <div class="container">
        <div class="cta">
          <div>
            <h3>Help build the most open Bitcoin map on the internet.</h3>
            <p>Open the map, add a place, or share a curated list on Nostr.</p>
          </div>
          <div class="btn-row">
            <a class="btn primary" href="https://btcmap.org">Open the Map</a>
            <a class="btn" href="https://btcmap.org/add">Add a Place</a>
            <a class="btn primary" href="https://btcmap.org/map">Open the Map</a>
            <a class="btn" href="YOUR_ADD_PLACE_URL">Add a Place</a>
          </div>
        </div>
      </div>
    </section>

  </main>

  <footer>
    <div class="container">
      <div class="footer-row">
        <div>
          <strong style="color:var(--text);">Bitcoin Map on Nostr</strong><br/>
          <span>Signed listings • Portable data • Community curation</span>
        </div>
        <div class="footer-links">
          <a href="https://btcmap.org">App</a>
          <a href="https://github.com/btcmaporg/btc-mappie" target="_blank" rel="noreferrer">GitHub</a>
          <a href="https://njump.me/npub1us70e7q3jfxgvr4hghp8kaxjp0hg6aa2ux0qvd2s4m4y6d3wz46srr9g0u" target="_blank" rel="noreferrer">Nostr</a>
          <a href="mailto:hello@btcmap.org">Contact</a>
          <a href="https://btcmap.org/map">App</a>
          <a href="YOUR_GITHUB_URL" target="_blank" rel="noreferrer">GitHub</a>
          <a href="YOUR_NOSTR_PROFILE_URL" target="_blank" rel="noreferrer">Nostr</a>
          <a href="mailto:YOUR_EMAIL">Contact</a>
        </div>
      </div>
      <div style="margin-top:10px; color:rgba(169,182,199,.85);">
        © <span id="year"></span> — Built for the Bitcoin + Nostr ecosystem.
      </div>
    </div>
  </footer>

  <script>
    document.getElementById("year").textContent = new Date().getFullYear();

    // ── Live Bitcoin Map ──────────────────────────────────────────────
    (function () {
      var DEFAULT_LAT = 48.8566;
      var DEFAULT_LNG = 2.3522;
      var DEFAULT_ZOOM = 13;
      var FETCH_RADIUS_KM = 15;

      // Dark map tiles
      var map = L.map("hero-map", {
        zoomControl: true,
        attributionControl: true,
      }).setView([DEFAULT_LAT, DEFAULT_LNG], 3);

      L.tileLayer(
        "https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png",
        {
          attribution:
            '&copy; <a href="https://www.openstreetmap.org/copyright">OSM</a> &copy; <a href="https://carto.com/">CARTO</a>',
          subdomains: "abcd",
          maxZoom: 19,
        }
      ).addTo(map);

      // Custom Bitcoin marker icon
      var btcIcon = L.divIcon({
        className: "",
        html: '<div class="btc-marker"></div>',
        iconSize: [22, 22],
        iconAnchor: [11, 11],
        popupAnchor: [0, -14],
      });

      var markerGroup = L.layerGroup().addTo(map);
      var loadingEl = document.getElementById("map-loading");
      var countEl = document.getElementById("merchant-count");

      function hideLoading() {
        loadingEl.classList.add("hidden");
        setTimeout(function () {
          loadingEl.style.display = "none";
        }, 400);
      }

      function showLoading() {
        loadingEl.style.display = "flex";
        loadingEl.classList.remove("hidden");
      }

      // Build popup HTML for a merchant
      function popupHtml(el) {
        var tags = el.osm_json && el.osm_json.tags ? el.osm_json.tags : {};
        var name = tags.name || tags["name:en"] || "Bitcoin location";
        var type = tags.amenity || tags.shop || tags.tourism || tags.office || "";
        var phone = tags.phone || "";
        var website = tags.website || tags["contact:website"] || "";
        var ln =
          tags["payment:lightning"] === "yes" ||
          tags["currency:XBT:lightning"] === "yes";
        var onchain =
          tags["payment:bitcoin"] === "yes" ||
          tags["currency:XBT"] === "yes";

        var html = '<div class="popup-name">' + escHtml(name) + "</div>";
        if (type)
          html +=
            '<div class="popup-meta" style="text-transform:capitalize;">' +
            escHtml(type.replace(/_/g, " ")) +
            "</div>";
        html += '<div class="popup-tags">';
        if (ln) html += '<span class="popup-tag ln">Lightning</span>';
        if (onchain) html += '<span class="popup-tag">On-chain</span>';
        if (!ln && !onchain) html += '<span class="popup-tag">Bitcoin</span>';
        html += "</div>";
        if (phone)
          html +=
            '<div class="popup-meta" style="margin-top:6px;">' +
            escHtml(phone) +
            "</div>";
        if (website)
          html +=
            '<div class="popup-meta" style="margin-top:3px;"><a href="' +
            escAttr(website) +
            '" target="_blank" rel="noreferrer" style="color:var(--accent2);text-decoration:underline;">' +
            escHtml(
              website.replace(/^https?:\/\//, "").replace(/\/$/, "")
            ) +
            "</a></div>";
        return html;
      }

      function escHtml(s) {
        var d = document.createElement("div");
        d.textContent = s;
        return d.innerHTML;
      }
      function escAttr(s) {
        return s
          .replace(/&/g, "&amp;")
          .replace(/"/g, "&quot;")
          .replace(/'/g, "&#39;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;");
      }

      // Fetch nearby merchants from BTCMap.org API
      function fetchMerchants(lat, lng) {
        showLoading();
        markerGroup.clearLayers();
        var bounds = getBbox(lat, lng, FETCH_RADIUS_KM);
        var url =
          "https://api.btcmap.org/v2/elements?updated_since=2022-01-01T00:00:00.000Z&limit=200";

        fetch(url)
          .then(function (r) {
            return r.json();
          })
          .then(function (data) {
            var elements = data;
            var count = 0;
            var inBounds = [];

            elements.forEach(function (el) {
              var osmData = el.osm_json || {};
              var elLat = osmData.lat;
              var elLng = osmData.lon;

              // Some elements have center coords instead
              if (!elLat && osmData.bounds) {
                elLat =
                  (osmData.bounds.minlat + osmData.bounds.maxlat) / 2;
                elLng =
                  (osmData.bounds.minlon + osmData.bounds.maxlon) / 2;
              }

              if (!elLat || !elLng) return;

              // Filter to bounding box
              if (
                elLat >= bounds.south &&
                elLat <= bounds.north &&
                elLng >= bounds.west &&
                elLng <= bounds.east
              ) {
                inBounds.push({ el: el, lat: elLat, lng: elLng });
              }
            });

            // If API returned fewer results than we need, also try area-based endpoint
            if (inBounds.length === 0 && elements.length > 0) {
              // Fall back to showing all fetched elements on map
              elements.forEach(function (el) {
                var osmData = el.osm_json || {};
                var elLat = osmData.lat;
                var elLng = osmData.lon;
                if (!elLat && osmData.bounds) {
                  elLat =
                    (osmData.bounds.minlat + osmData.bounds.maxlat) / 2;
                  elLng =
                    (osmData.bounds.minlon + osmData.bounds.maxlon) / 2;
                }
                if (!elLat || !elLng) return;
                inBounds.push({ el: el, lat: elLat, lng: elLng });
              });
            }

            inBounds.forEach(function (item) {
              var marker = L.marker([item.lat, item.lng], {
                icon: btcIcon,
              });
              marker.bindPopup(popupHtml(item.el), {
                className: "btc-popup",
                maxWidth: 260,
              });
              markerGroup.addLayer(marker);
              count++;
            });

            countEl.textContent = count;
            hideLoading();

            // Fit map to show markers if we have some
            if (count > 0 && markerGroup.getLayers().length > 0) {
              var group = new L.featureGroup(markerGroup.getLayers());
              map.fitBounds(group.getBounds().pad(0.15), {
                maxZoom: 15,
              });
            }
          })
          .catch(function () {
            countEl.textContent = "—";
            hideLoading();
          });
      }

      // Also try the area-based endpoint for better local coverage
      function fetchByArea(lat, lng) {
        showLoading();
        markerGroup.clearLayers();
        var bounds = getBbox(lat, lng, FETCH_RADIUS_KM);
        var areaUrl =
          "https://api.btcmap.org/v3/elements?bbox=" +
          bounds.west + "," + bounds.south + "," + bounds.east + "," + bounds.north +
          "&limit=200";
        var fallbackUrl =
          "https://api.btcmap.org/v2/elements?updated_since=2023-01-01T00:00:00.000Z&limit=200";

        fetch(areaUrl)
          .then(function (r) {
            if (!r.ok) throw new Error("v3 not available");
            return r.json();
          })
          .then(function (data) {
            renderElements(Array.isArray(data) ? data : (data.elements || []), lat, lng, bounds);
          })
          .catch(function () {
            // Fallback to v2 endpoint
            fetch(fallbackUrl)
              .then(function (r) { return r.json(); })
              .then(function (data) {
                renderElements(Array.isArray(data) ? data : [], lat, lng, bounds);
              })
              .catch(function () {
                countEl.textContent = "—";
                hideLoading();
              });
          });
      }

      function renderElements(elements, lat, lng, bounds) {
        var count = 0;
        elements.forEach(function (el) {
          var osmData = el.osm_json || el;
          var elLat = osmData.lat;
          var elLng = osmData.lon;
          if (!elLat && osmData.bounds) {
            elLat = (osmData.bounds.minlat + osmData.bounds.maxlat) / 2;
            elLng = (osmData.bounds.minlon + osmData.bounds.maxlon) / 2;
          }
          if (!elLat || !elLng) return;
          // If we have bounds, filter; otherwise show all
          if (bounds && !(elLat >= bounds.south && elLat <= bounds.north &&
              elLng >= bounds.west && elLng <= bounds.east)) return;

          var marker = L.marker([elLat, elLng], { icon: btcIcon });
          marker.bindPopup(popupHtml(el), {
            className: "btc-popup",
            maxWidth: 260,
          });
          markerGroup.addLayer(marker);
          count++;
        });

        countEl.textContent = count;
        hideLoading();

        if (count > 0) {
          var group = new L.featureGroup(markerGroup.getLayers());
          map.fitBounds(group.getBounds().pad(0.15), { maxZoom: 15 });
        } else {
          map.setView([lat, lng], DEFAULT_ZOOM);
        }
      }

      function getBbox(lat, lng, radiusKm) {
        var latDeg = radiusKm / 111.32;
        var lngDeg = radiusKm / (111.32 * Math.cos((lat * Math.PI) / 180));
        return {
          south: lat - latDeg,
          north: lat + latDeg,
          west: lng - lngDeg,
          east: lng + lngDeg,
        };
      }

      // Geolocate and load
      function geolocate() {
        if (!navigator.geolocation) {
          fetchByArea(DEFAULT_LAT, DEFAULT_LNG);
          return;
        }
        navigator.geolocation.getCurrentPosition(
          function (pos) {
            var lat = pos.coords.latitude;
            var lng = pos.coords.longitude;
            map.setView([lat, lng], DEFAULT_ZOOM);

            // Add user location circle
            L.circleMarker([lat, lng], {
              radius: 8,
              fillColor: "#7dd3fc",
              fillOpacity: 0.9,
              color: "#fff",
              weight: 2.5,
            })
              .addTo(map)
              .bindPopup(
                '<div style="font-family:var(--font);font-weight:700;font-size:13px;">You are here</div>',
                { className: "btc-popup" }
              );

            fetchByArea(lat, lng);
          },
          function () {
            // Permission denied or error — use default
            fetchByArea(DEFAULT_LAT, DEFAULT_LNG);
          },
          { enableHighAccuracy: false, timeout: 8000 }
        );
      }

      // Locate button
      document.getElementById("locate-btn").addEventListener("click", function () {
        geolocate();
      });

      // Click map to tag a Bitcoin place on OpenStreetMap
      map.on("click", function (e) {
        var lat = e.latlng.lat.toFixed(6);
        var lng = e.latlng.lng.toFixed(6);
        var zoom = map.getZoom() < 17 ? 17 : map.getZoom();

        var editUrl =
          "https://www.openstreetmap.org/edit#map=" + zoom + "/" + lat + "/" + lng;
        var noteUrl =
          "https://www.openstreetmap.org/note/new#map=" + zoom + "/" + lat + "/" + lng +
          "&layers=N&note=This%20place%20accepts%20Bitcoin.%20Please%20add%20payment:bitcoin=yes%20tag.";

        var html =
          '<div class="tag-title">' +
            '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>' +
            'Tag a Bitcoin place here' +
          '</div>' +
          '<div class="tag-coords">' + lat + ', ' + lng + '</div>' +
          '<a class="tag-btn" href="' + editUrl + '" target="_blank" rel="noreferrer">' +
            '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>' +
            'Edit map on OSM' +
          '</a>' +
          '<a class="tag-btn" href="' + noteUrl + '" target="_blank" rel="noreferrer">' +
            '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>' +
            'Leave a note on OSM' +
          '</a>' +
          '<div class="tag-hint">Add <strong>payment:bitcoin=yes</strong> and <strong>currency:XBT:lightning=yes</strong> tags to mark this place as Bitcoin-friendly.</div>';

        L.popup({ className: "tag-popup", maxWidth: 240 })
          .setLatLng(e.latlng)
          .setContent(html)
          .openOn(map);
      });

      // Sync stat counter
      var statPlaces = document.getElementById("stat-places");
      var observer = new MutationObserver(function () {
        var val = countEl.textContent;
        statPlaces.textContent = val === "0" ? "Searching..." : val + " found";
      });
      observer.observe(countEl, { childList: true, characterData: true, subtree: true });

      // Init
      geolocate();
    })();
  </script>
</body>
</html>
